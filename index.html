<!-- 引入 Google API -->
<script src="https://apis.google.com/js/api.js"></script>
<script>
  // Google API 初始化
  function handleClientLoad() {
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
    gapi.client.init({
      apiKey: "YOUR_API_KEY", // 這裡要換成你申請的 API Key
      clientId: "YOUR_CLIENT_ID.apps.googleusercontent.com", // OAuth 2.0 用戶端 ID
      discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
      scope: "https://www.googleapis.com/auth/drive.file"
    }).then(() => {
      document.getElementById("uploadBtn").onclick = uploadFile;
    });
  }

  function uploadFile() {
    const content = JSON.stringify(localStorage.getItem("splitData")); // 存你分帳資料
    const file = new Blob([content], {type: "application/json"});

    const metadata = {
      name: "AA分帳資料.json",
      mimeType: "application/json"
    };

    const accessToken = gapi.auth.getToken().access_token;
    const form = new FormData();
    form.append("metadata", new Blob([JSON.stringify(metadata)], {type: "application/json"}));
    form.append("file", file);

    fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
      method: "POST",
      headers: new Headers({ "Authorization": "Bearer " + accessToken }),
      body: form
    }).then(res => res.json())
      .then(val => alert("已上傳到 Google Drive！ 檔案 ID: " + val.id));
  }
</script>

<!-- 呼叫 Google API -->
<script async defer src="https://apis.google.com/js/api.js" 
        onload="this.onload=function(){};handleClientLoad()" 
        onreadystatechange="if (this.readyState === 'complete') handleClientLoad()">
</script>

<!-- 在你的頁面加一個按鈕 -->
<button id="uploadBtn">上傳到 Google Drive</button>
